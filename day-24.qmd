---
title: "Daily Assignment 24"
subtitle: 'Ecosystem Science and Sustainability 330'
author:
  - name: Samantha Nauman
    email: "snauman4@colostate.edu"
format: html
execute:
  echo: true
---
```{r}
# 1. Install packages
install.packages(c("sf", "terra", "mapview", "remotes"))

# 2. Install AOI from GitHub
remotes::install_github("mikejohnson51/AOI")

# 3. Make sure everything is set up correctly
sf::sf_extSoftVersion()
terra::gdal()
```

```{r}
library(sf)
library(dplyr)
library(terra)
library(mapview)
library(AOI)
library(ggplot2)
library(ggrepel)
# 1. read in the U.S. cities CSV
us_cities <- readr::read_csv("data/uscities.csv")

# 2. convert to an sf object (raw coords are in WGS84 lon/lat)
cities_sf <- us_cities %>% 
  st_as_sf(coords = c("lng", "lat"), crs = 4326, remove = FALSE)

# 3. grab Larimer County boundary
larimer_county <- aoi_get(state = "CO", county = "Larimer") %>% 
  st_transform(crs = st_crs(cities_sf))

# 4. filter for only the cities that fall within Larimer County
cities_larimer <- st_filter(cities_sf, larimer_county)

# 5. pick out the three largest by population
#    (adjust the column name if yours is different—e.g. `population`, `pop`, etc.)
three_largest <- cities_larimer %>% 
  arrange(desc(population)) %>% 
  slice_head(n = 3)

# 6. build the map
map <- ggplot() +
  # county outline
  geom_sf(data = larimer_county, fill = "white", color = "black") +
  # all Larimer cities as small black dots
  geom_sf(data = cities_larimer, color = "black", size = 1) +
  # highlight the top 3 in red
  geom_sf(data = three_largest, color = "red", size = 3) +
  # smart labels for the top 3
  geom_label_repel(
    data    = three_largest,
    aes(label = city, geometry = geometry),
    stat    = "sf_coordinates",
    size    = 3,
    min.segment.length = 0
  ) +
  # titles and caption
  labs(
    title    = "Cities in Larimer County, Colorado",
    subtitle = "Population by city",
    caption  = "Source: SimpleMaps"
  ) +
  theme_minimal()

# 7. display it
print(map)

# 8. save out to your project’s images directory
ggsave(
  filename = "img/larimer_county_cities.png",
  plot     = map,
  width    = 8,
  height   = 6,
  dpi      = 300
)

```
